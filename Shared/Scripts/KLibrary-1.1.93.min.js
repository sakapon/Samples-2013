var KLibrary;(function(KLibrary){function copyObject(src,dest){if(src==null)return;if(dest==null)return;for(var p in src)dest[p]=src[p]}KLibrary.copyObject=copyObject;function isArray(obj){return obj!=null&&("length"in obj)&&!(obj instanceof Function)}KLibrary.isArray=isArray;function toArray(obj){if(obj==null)return[];var a=[];if(isArray(obj))a.push.apply(a,obj);else for(var p in obj)a.push({key:p,value:obj[p]});return a}KLibrary.toArray=toArray;function isNullOrEmpty(obj){return obj==null||obj.length===0}KLibrary.isNullOrEmpty=isNullOrEmpty;String.prototype.toDate=function(){var m=this.match(/^\/Date\(([0-9]+)(.*)\)\/$/g);return new Date(m==null?this:parseInt(RegExp.$1))};String.prototype.padLeft=function(width,c){if(width==null)return this;if(c==null)c=" ";var s=this;while(s.length<width)s=c+s;return s};String.prototype.padRight=function(width,c){if(width==null)return this;if(c==null)c=" ";var s=this;while(s.length<width)s=s+c;return s};function padInt(n,width){return n.toString().padLeft(width,"0")}String.prototype.trimLeft=function(c){if(c==null)c=" ";var s=this;while(s.length>0&&s.charAt(0)===c)s=s.substring(1);return s};String.prototype.trimRight=function(c){if(c==null)c=" ";var s=this;while(s.length>0&&s.charAt(s.length-1)===c)s=s.substring(0,s.length-1);return s};String.prototype.trim2=function(c){if(c==null)c=" ";return this.trimLeft(c).trimRight(c)};Date.prototype.addHours=function(v){return new Date(this.getTime()+v*60*60*1000)};function format(_format,args){if(!(args instanceof Array))args=toArray(arguments).slice(1);return _format.replace(/\{([0-9]+)(:[^\}]*)?\}/g,function(m,g1,g2){var v=args[parseInt(g1)];if(v==null)return"";return(typeof v==="number"||v instanceof Date)?v.format(isNullOrEmpty(g2)?null:g2.substring(1)):v.toString()})}KLibrary.format=format;function formatObject(template,obj,encodeHtml){return template.replace(/\$\{([a-zA-Z0-9_\.\[\]]*)(>[^:\}]*)?(:[^\}]*)?\}/g,function(m,g1,g2,g3){var v;try{v=eval(format("obj{0}{1}",(isNullOrEmpty(g1)||g1.charAt(0)==="[")?"":".",g1))}catch(err){v=null}if(!isNullOrEmpty(g2))v=eval(g2.substring(1))(v);if(v==null)return"";var s=(typeof v==="number"||v instanceof Date)?v.format(isNullOrEmpty(g3)?null:g3.substring(1)):v.toString();return g3===":R"?s:encodeHtml?htmlEncode(s):s})}KLibrary.formatObject=formatObject;Number.prototype.format=function(_format){if(_format==null)return this.toString();var number=this;return _format.replace(/([nNxX])(\d*)/g,function(s,g1,g2){return formatNumber(number,g1,isNullOrEmpty(g2)?0:parseInt(g2))})};function formatNumber(number,c,length){switch(c){case"n":case"N":return number.toString().replace(/\d(?=(\d{3})+(\.\d+)?$)/g,"$&,");case"x":return padInt(number.toString(16).toLowerCase(),length);case"X":return padInt(number.toString(16).toUpperCase(),length);default:return c}}Date.prototype.format=function(_format){if(_format==null)switch(getLanguage().toLowerCase()){case"ja":_format="yyyy/MM/dd H:mm:ss";break;default:_format="M/d/yyyy h:mm:ss tt";break}var date=this;return _format.replace(/y{1,5}|M{1,4}|d{1,4}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|f{1,3}|t{1,2}|z{1,3}/g,function(s){return formatDateProperty(date,s.charAt(0),s.length)})};function formatDateProperty(date,c,length){switch(c){case"y":var year=length>2?date.getFullYear():date.getFullYear()%100;return padInt(year,length);case"M":return length>2?getMonthName(date.getMonth()+1,length==3):padInt(date.getMonth()+1,length);case"d":return length>2?getDayOfWeekName(date.getDay(),length==3):padInt(date.getDate(),length);case"h":return padInt(date.getHours()%12,length);case"H":return padInt(date.getHours(),length);case"m":return padInt(date.getMinutes(),length);case"s":return padInt(date.getSeconds(),length);case"f":return padInt(date.getMilliseconds(),3).substr(0,length);case"t":return(date.getHours()<12?"AM":"PM").substr(0,length);case"z":var offset=date.getTimezoneOffset();var sign=offset<0?"+":offset>0?"-":"";if(length>2){var offsetH=Math.floor(Math.abs(offset)/60);var offsetM=Math.abs(offset)%60;return sign+padInt(offsetH,2)+":"+padInt(offsetM,2)}else return sign+(length==2&&Math.abs(offset)<600?"0":"")+(Math.abs(offset)/60).toString();default:return c}}var _monthNames;var _getMonthFull;var _getMonthShort;function getMonthName(month,short){if(_getMonthFull==null)switch(getLanguage().toLowerCase()){case"ja":_getMonthFull=function(i){return i.toString()+"月"};_getMonthShort=function(i){return i.toString()};break;default:_monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];_getMonthFull=function(i){return _monthNames[i]};_getMonthShort=function(i){return _monthNames[i].substr(0,3)};break}return(!short?_getMonthFull:_getMonthShort)(month)}var _dowNames;var _getDowFull;var _getDowShort;function getDayOfWeekName(dayOfWeek,short){if(_getDowFull==null)switch(getLanguage().toLowerCase()){case"ja":_dowNames=["日曜日","月曜日","火曜日","水曜日","木曜日","金曜日","土曜日"];_getDowFull=function(i){return _dowNames[i]};_getDowShort=function(i){return _dowNames[i].substr(0,1)};break;default:_dowNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];_getDowFull=function(i){return _dowNames[i]};_getDowShort=function(i){return _dowNames[i].substr(0,3)};break}return(!short?_getDowFull:_getDowShort)(dayOfWeek)}function getLanguage(){var l=navigator.browserLanguage||navigator.language||navigator.userLanguage;if(l==null)return undefined;return l.split("-")[0]}KLibrary.getLanguage=getLanguage;function htmlEncode(s){return s.replace(/["&'<>]/g,htmlEncodeChar);function htmlEncodeChar(c){switch(c){case"\"":return"&quot;";case"&":return"&amp;";case"\'":return"&#39;";case"<":return"&lt;";case">":return"&gt;";default:return c}}}KLibrary.htmlEncode=htmlEncode;function toObservable(obj){return!(obj instanceof Array)?new Observable(obj):obj.select(function(x){return new Observable(x)})}KLibrary.toObservable=toObservable;var Observable=(function(){function Observable(obj){if(obj==null)return;for(var p in obj)Object.defineProperty(this,p,createDescriptor(p,obj[p]))}function createDescriptor(name,value0){var value=value0;return{get:function(){return value},set:function(v){if(value===v)return;value=v;$(this).trigger("propertychange",[name,v])},enumerable:true,configurable:true}}return Observable})();KLibrary.Observable=Observable;(function(ArrayEx){function range(start,count){if(start==null)start=0;if(count==null)count=0;var maxValue=start+count;var a=[];for(var i=start;i<maxValue;i++)a.push(i);return a}ArrayEx.range=range;Array.prototype.toDictionary=function(toKey,toValue){if(toKey==null)return{};if(toValue==null)toValue=function(x){return x};var o={};for(var i=0;i<this.length;i++)o[toKey.call(this,this[i],i)]=toValue.call(this,this[i],i);return o};Array.prototype.all=function(predicate){if(predicate==null)predicate=function(x){return false};for(var i=0;i<this.length;i++)if(!predicate.call(this,this[i],i))return false;return true};Array.prototype.any=function(predicate){if(predicate==null)predicate=function(x){return true};for(var i=0;i<this.length;i++)if(predicate.call(this,this[i],i))return true;return false};Array.prototype.contains=function(value){return this.any(function(x){return x===value})};Array.prototype.each=function(action){if(action==null)return this;for(var i=0;i<this.length;i++)action.call(this,this[i],i);return this};Array.prototype.first=function(predicate){if(predicate){for(var i=0;i<this.length;i++)if(predicate.call(this,this[i],i))return this[i];return null}else return this.length>0?this[0]:null};Array.prototype.last=function(predicate){if(predicate){for(var i=this.length-1;i>=0;i--)if(predicate.call(this,this[i],i))return this[i];return null}else return this.length>0?this[this.length-1]:null};Array.prototype.groupBy=function(toKey,toValue){var d=this.groupByToDictionary(toKey,toValue);return toArray(d)};Array.prototype.groupByToDictionary=function(toKey,toValue){if(toKey==null)return{};if(toValue==null)toValue=function(x){return x};var d={};for(var i=0;i<this.length;i++){var key=toKey.call(this,this[i],i);var value=toValue.call(this,this[i],i);if(!d[key])d[key]=[];d[key].push(value)}return d};Array.prototype.orderBy=function(toKey){if(toKey==null)return this;var keyed=this.select(function(x,i){return{key:toKey.call(this,x,i),obj:x}});return mergeSort(keyed).select(function(x){return x.obj})};function mergeSort(target){if(target.length==2){if(target[0].key>target[1].key){var o=target[0];target[0]=target[1];target[1]=o}}else if(target.length>2){var m=Math.floor(target.length/2);var a1=mergeSort(target.slice(0,m));var a2=mergeSort(target.slice(m));var i1=0;var i2=0;while(i1<a1.length||i2<a2.length)if(i2==a2.length||i1<a1.length&&a1[i1].key<=a2[i2].key){target[i1+i2]=a1[i1];i1++}else{target[i1+i2]=a2[i2];i2++}}return target}Array.prototype.select=function(selector){if(selector==null)return this;var a=[];for(var i=0;i<this.length;i++)a.push(selector.call(this,this[i],i));return a};Array.prototype.where=function(predicate){if(predicate==null)return this;var a=[];for(var i=0;i<this.length;i++)if(predicate.call(this,this[i],i))a.push(this[i]);return a}})(KLibrary.ArrayEx||(KLibrary.ArrayEx={}));var ArrayEx=KLibrary.ArrayEx;(function(Css){var cssRulesIndexes={};function setCssRules(id,cssRules){if(id==null)return;if(!(cssRules instanceof Array))cssRules=toArray(arguments).slice(1);if(cssRulesIndexes[id]==null){var isCompleted=setCssRulesToHead(id,cssRules);if(isCompleted)return;cssRulesIndexes[id]=setCssRulesToDocument(null,cssRules)}else cssRulesIndexes[id]=setCssRulesToDocument(cssRulesIndexes[id],cssRules)}Css.setCssRules=setCssRules;function setCssRulesToHead(id,cssRules){if(id==null)return;if(!(cssRules instanceof Array))cssRules=toArray(arguments).slice(1);$("#"+id).remove();var styleSheet=$("<style></style>").attr("id",id).attr("type","text/css").appendTo("head")[0].sheet;if(!styleSheet)return false;cssRules.forEach(function(r,i){try{styleSheet.insertRule(format("{0} { {1} }",r.selector,r.style),i)}catch(err){}});return true}Css.setCssRulesToHead=setCssRulesToHead;function setCssRulesToDocument(sheetIndex,cssRules){if(sheetIndex==null)sheetIndex=document.styleSheets.length;if(!(cssRules instanceof Array))cssRules=toArray(arguments).slice(1);var sheet=sheetIndex<document.styleSheets.length?document.styleSheets[sheetIndex]:null;if(sheet)while(sheet.rules.length>0)sheet.removeRule(0);else{sheet=document.createStyleSheet();sheetIndex=document.styleSheets.length-1}for(var i=0;i<cssRules.length;i++){var r=cssRules[i];try{sheet.addRule(r.selector,r.style)}catch(err){}}return sheetIndex}Css.setCssRulesToDocument=setCssRulesToDocument;function createCssRule(selector,style){return{selector:selector,style:style}}Css.createCssRule=createCssRule})(KLibrary.Css||(KLibrary.Css={}));var Css=KLibrary.Css;(function(IO){function getCookie(key,defaultValue){if(key==null)return defaultValue;if(document.cookie==null)return defaultValue;var regexp=new RegExp("^\\s*"+key+"=([^;]*)$","g");var pair=document.cookie.split(";").last(function(x){return x.search(regexp)!=-1});if(pair==null)return defaultValue;return decodeURIComponent(RegExp.$1)}IO.getCookie=getCookie;function setCookie(key,value,days,domain,path,isSecure){var cookie=format("{0}={1};",key,encodeURIComponent(value));if(days){var expired=new Date;expired.setTime(expired.getTime()+days*24*60*60*1000);cookie=format("{0} expires={1};",cookie,expired.toGMTString())}if(domain)cookie=format("{0} domain={1};",cookie,domain);if(path)cookie=format("{0} path={1};",cookie,path);if(isSecure)cookie+=" secure";document.cookie=cookie}IO.setCookie=setCookie})(KLibrary.IO||(KLibrary.IO={}));var IO=KLibrary.IO;(function(Uri){function getTopDomain(){var m=document.domain.match(/([^\.]+\.)?[^\.]+$/g);if(m==null)return"";return m[0]}Uri.getTopDomain=getTopDomain;function getQueryString(){var s=document.location.search;if(isNullOrEmpty(s))return{};var d=s.trimLeft("?").split("&").select(function(x){var p=x.split("=");return{key:p[0].toLowerCase(),value:decodeURIComponent(p[1])}}).groupByToDictionary(function(x){return x.key},function(x){return x.value});for(var p in d)d[p]=d[p].join(",");return d}Uri.getQueryString=getQueryString;function getAnchor(){if(!document.location.hash||document.location.hash.charAt(0)!="#")return null;return document.location.hash.substring(1)}Uri.getAnchor=getAnchor})(KLibrary.Uri||(KLibrary.Uri={}));var Uri=KLibrary.Uri})(KLibrary||(KLibrary={}));(function($){$.ajaxGetByForm=function(url,data){return $.ajax(url,{type:"GET",data:data,dataType:"json"})};$.ajaxGetByJSON=function(url,data){return $.ajax(url,{type:"GET",data:data==null?undefined:{q:JSON.stringify(data)},dataType:"json"})};$.ajaxInvokeByForm=function(url,data,method){return $.ajax(url,{type:method==null?"POST":method,data:data,dataType:"json"})};$.ajaxInvokeByJSON=function(url,data,method){return $.ajax(url,{type:method==null?"POST":method,data:data==null?undefined:JSON.stringify(data),contentType:"application/json; charset=utf-8",dataType:"json"})};$.fn.descendantsAndSelf=function(selector){return this.filter(selector).add(this.find(selector))};$.fn.defineProperty=function(name,getFunc,setFunc){if(name==null)return this;return this.each(function(i){if(this==null)return;Object.defineProperty(this,name,{get:getFunc,set:setFunc,enumerable:true,configurable:true})})};$.fn.updateTarget=function(){return this.descendantsAndSelf("[data-context]").empty().each(function(i){var target=$(this);var source=eval(target.data("context"));if(source==null)return;var templateEl=target.data("template")?$("#"+target.data("template")):target.next("script:first");if(templateEl.length==0)return;var template=templateEl.html();$(source).map(function(){var formatted=KLibrary.formatObject(template,this,true);return $(formatted).get()}).appendTo(target)})};$.fn.bindData=function(){return this.descendantsAndSelf("[data-context]").each(function(i){var target=$(this);var source=eval(target.data("context"));if(source==null)return;if((source instanceof Object)&&!(source instanceof KLibrary.Observable)&&!(source instanceof Date))source=eval(target.data("context")+" = KLibrary.toObservable(source);");target.updateTarget();$(source).on("propertychange",function(e,n,v){target.updateTarget()})})};$.fn.setIsEnabled=function(isEnabled){return isEnabled?this.removeAttr("disabled"):this.attr("disabled","disabled")}})(jQuery)